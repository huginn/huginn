<% content_for :head do %>
  <%= javascript_include_tag "digraph" %>
<% end %>

<div class='container'>
  <div class='row'>
    <div class='span12'>
      <div class="page-header">
        <h2>Agent Event Flow</h2>
      </div>
      <div class="btn-group">
        <%= link_to '<i class="icon-chevron-left"></i> Back'.html_safe, agents_path, class: "btn" %>
      </div>

      <div class='digraph'>
      </div>

    </div>
  </div>
</div>

<script>
  $(function() {
    var nodes = <%= Utils.jsonify(
      @agents.map{|agent| {:data => { :id => agent.id.to_s, :name => agent.name }}}
    ) %>;

    var edges = <%= Utils.jsonify(
      @agents.map {|agent| (agent.receivers.map {|reciever| {:data => {source: agent.id.to_s, target: reciever.id.to_s}}})}.flatten
    )%>

    renderDigraph(nodes, edges);
  });
</script>
